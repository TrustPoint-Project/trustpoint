{% extends 'trustpoint/base.html' %} {% block content %}
<div class="row py-3 px-0">
  <h1>Summary</h1>
</div>
<!-- Number panels row -->
<div class="row py-3 shadow">
  <!-- number of root CAs -->
  <div class="col-3">
    <div class="row p-2">
      <div class="card count bg-gray text-black shadow">
        <!-- <h2 class="text-center pb-4"><i class="bi bi-cpu"></i></h2> -->
        <h2 class="text-center pb-4 pt-2">Number of Root CAs</h2>
        <p style="font-size: 40px" class="text-center font-weight-bold">{{number_of_root_cas}}</p>
        <div class="row">
          <div class="col-5 small">Active: 2</div>
          <div class="col-5 offset-2 small p-0">Inactive: 0</div>
        </div>
        <div class="row pt-0 pb-1">
          <div class="progress col-5 p-0">
            <div
              class="progress-bar bg-progress progress-bar-striped w-100"
              role="progressbar "
              aria-valuenow="100"
              aria-valuemin="0"
              aria-valuemax="100"
            ></div>
          </div>
          <div class="progress col-5 p-0 offset-2">
            <div
              class="progress-bar bg-warning progress-bar-striped w-0"
              role="progressbar"
              aria-valuenow="0"
              aria-valuemin="0"
              aria-valuemax="100"
            ></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- number of issuing CAs -->
  <div class="col-3">
    <div class="row p-2">
      <div class="card count bg-gray text-black shadow">
        <!-- <h2 class="text-center pb-4"><i class="bi bi-key"></i></h2> -->
        <h2 class="text-center pb-4 pt-2">Number of Issuing CAs</h2>
        <p style="font-size: 40px" class="text-center font-weight-bold">
          {{number_of_issuing_cas}}
        </p>
        <div class="row p-0">
          <div class="col-5 small">Active: 2</div>
          <div class="col-5 offset-2 small p-0">Inactive: 1</div>
        </div>
        <div class="row pt-0 pb-1">
          <div
            class="progress col-5 p-0"
            role="progressbar"
            aria-valuenow="66"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            <div class="progress-bar progress-bar-striped" style="width: 66%"></div>
          </div>
          <div
            class="progress col-5 p-0 offset-2"
            role="progressbar"
            aria-valuenow="33"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            <div class="progress-bar progress-bar-striped bg-warning" style="width: 34%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- number of endpoints -->
  <div class="col-3">
    <div class="row p-2">
      <div class="card count bg-gray text-black shadow">
        <!-- <h2 class="text-center pb-4"><i class="bi bi-key"></i></h2> -->
        <h2 class="text-center pb-4 pt-2">Number of Endpoints</h2>
        <p style="font-size: 40px" class="text-center font-weight-bold">{{number_of_endpoints}}</p>
        <div class="row p-0">
          <div class="col-5 small">Active: 3</div>
          <div class="col-5 offset-2 small p-0">Inactive: 1</div>
        </div>
        <div class="row pt-0 pb-1">
          <div
            class="progress col-5 p-0"
            role="progressbar"
            aria-valuenow="75"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            <div class="progress-bar progress-bar-striped" style="width: 75%"></div>
          </div>
          <div
            class="progress col-5 p-0 offset-2"
            role="progressbar"
            aria-valuenow="25"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            <div class="progress-bar progress-bar-striped bg-warning" style="width: 25%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- number of devices -->
  <div class="col-3">
    <div class="row p-2">
      <div class="card count bg-gray text-black shadow">
        <!-- <h2 class="text-center pb-4"><i class="bi bi-key"></i></h2> -->
        <h2 class="text-center pb-4 pt-2">Number of Devices</h2>
        <p style="font-size: 40px" class="text-center font-weight-bold">{{number_of_devices}}</p>
        <div class="row p-0">
          <div class="col-5 small">Onboard: 12</div>
          <div class="col-5 offset-2 small p-0">Notonboard: 3</div>
        </div>
        <div class="row pt-0 pb-1">
          <div
            class="progress col-5 p-0"
            role="progressbar"
            aria-valuenow="80"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            <div class="progress-bar progress-bar-striped" style="width: 80%"></div>
          </div>
          <div
            class="progress col-5 p-0 offset-2"
            role="progressbar"
            aria-valuenow="20"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            <div class="progress-bar progress-bar-striped bg-warning" style="width: 20%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- {% if show_content %}
<p>This content is conditionally visible based on the 'show_content' variable.</p>
{% else %}
<p>The content is hidden because 'show_content' is False.</p>
{% endif %} -->
<div class="row py-3 px-0">
  <h1>Tables</h1>
</div>
<!-- Tables row -->
<div class="row p-3 shadow">
  <!-- table  Tab Navigation -->
  <ul class="nav nav-tabs" id="tableTabs">
    <li class="nav-alert">
      <a class="nav-link active" data-bs-toggle="tab" href="#alert">Alert</a>
    </li>
    <li class="nav-alert">
      <a class="nav-link" data-bs-toggle="tab" href="#certificate">Certificate</a>
    </li>
    <li class="nav-alert">
      <a class="nav-link" data-bs-toggle="tab" href="#device">Device</a>
    </li>
  </ul>

  <!-- table Tab Content -->
  <div class="tab-content px-0 shadow">
    <!-- alert tab content -->
    <div class="tab-pane fade show active" id="alert">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th class="text-blue" role="button" (click)="sort('name')">Type</th>
            <th class="text-blue" role="button" (click)="sort('version')">Message</th>
            <th class="text-blue">Time</th>
            <th class="text-blue">Extend</th>
            <th class="text-blue">Actions</th>
          </tr>
        </thead>
        <tbody id="alert-table-body"></tbody>
      </table>
    </div>
    <!-- certificate tab content -->
    <div class="tab-pane fade" id="certificate">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th class="text-blue" role="button" (click)="sort('name')">Name</th>
            <th class="text-blue" role="button" (click)="sort('version')">Common Name</th>
            <th class="text-blue">Valid Until</th>
            <th class="text-blue">Actions</th>
          </tr>
        </thead>
        <tbody id="certificate-table-body"></tbody>
      </table>
    </div>
    <!-- device tab content -->
    <div class="tab-pane fade" id="device">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th class="text-blue" role="button" (click)="sort('name')">Name</th>
            <th class="text-blue" role="button" (click)="sort('version')">Serial Number</th>
            <th class="text-blue">Domain</th>
            <th class="text-blue">Status</th>
            <th class="text-blue">Actions</th>
          </tr>
        </thead>
        <tbody id="device-table-body"></tbody>
      </table>
    </div>
  </div>
</div>
<div class="row py-3 px-0">
  <h1>Charts</h1>
</div>
<!-- Chart row -->
<div class="row p-3 shadow">
  <!-- table  Tab Navigation -->
  <ul class="nav nav-tabs" id="chartTabs">
    <li class="nav-alert">
      <a class="nav-link active" data-bs-toggle="tab" href="#deviceChartTab">Device</a>
    </li>
    <li class="nav-alert">
      <a class="nav-link" data-bs-toggle="tab" href="#certChartTab">Certificate</a>
    </li>
    <li class="nav-alert">
      <a class="nav-link" data-bs-toggle="tab" href="#caChartTab">CA</a>
    </li>
  </ul>

  <!-- chart Tab Content -->
  <div class="tab-content px-0">
    <div class="text-end py-2">
      <button class="btn btn-blue">Today</button>
      <button class="btn btn-blue">Last Week</button>
      <button class="btn btn-blue">Last Month</button>
      <button class="btn btn-blue">Life</button>
    </div>
    <!-- device chart tab content -->
    <div class="tab-pane fade show active" id="deviceChartTab">
      <div class="row p-3">
        <div class="col-4 px-1 shadow">
          <h2>Current Devices</h2>
          <canvas id="donutChartDevice" width="200" height="200"></canvas>
        </div>
        <div class="col-8 px-1 shadow">
          <h2>Devices</h2>
          <canvas id="stackChartDevice" width="400" height="200"></canvas>
        </div>
      </div>
    </div>
    <!-- certificate chart tab content -->
    <div class="tab-pane fade" id="certChartTab">
      <div class="row p-3">
        <div class="col-4 shadow">
          <h2>Current Certificates</h2>
          <canvas id="donutChartCert" width="200" height="200"></canvas>
        </div>
        <div class="col-8 shadow">
          <h2>Certificates</h2>
          <canvas id="stackedAreaChartCert" width="400" height="200"></canvas>
        </div>
      </div>
    </div>
    <!-- CA chart tab content -->
    <div class="tab-pane fade" id="caChartTab">
      <div class="row p-3">
        <div class="col-6 shadow">
          <h2>Root CAs</h2>
          <canvas id="lineChart" width="400" height="200"></canvas>
        </div>
        <div class="col-6 shadow">
          <h2>Issuing CA</h2>
          <canvas id=" barChartCA" width="400" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var alerts = JSON.parse("{{alerts|escapejs }}");
    var certs = JSON.parse("{{certs|escapejs }}");
    var devices = JSON.parse("{{devices|escapejs }}");
    // const alertTableBody = document.getElementById("alerts-table-body");
    // const certTableBody = document.getElementById("certs-table-body");
    // const deviceTableBody = document.getElementById("devices-table-body");
    //console.log("helo");
    var tableTabEl = document.getElementById("tableTabs");
    //console.log("tableTabEl", tabEl);
    var tableTab = new bootstrap.Tab(tableTabEl);
    // Initial update for the active tab
    var activeTabId = document
      .querySelector("#tableTabs .nav-link.active")
      .getAttribute("href")
      .substring(1);
    updateTableContent(activeTabId);

    // Add event listener for the 'shown.bs.tab' event
    tableTabEl.addEventListener("shown.bs.tab", function (event) {
      var targetId = event.target.getAttribute("href").substring(1);
      updateTableContent(targetId);
    });

    var chartTabEl = document.getElementById("chartTabs");
    console.log("chartTabEl", chartTabEl);
    var chartTab = new bootstrap.Tab(chartTabEl);
    // Initial update for the active tab
    var activeChartTabId = document
      .querySelector("#chartTabs .nav-link.active")
      .getAttribute("href")
      .substring(1);
    updateChartContent(activeChartTabId);

    // Add event listener for the 'shown.bs.tab' event
    chartTabEl.addEventListener("shown.bs.tab", function (event) {
      var targetId = event.target.getAttribute("href").substring(1);
      updateChartContent(targetId);
    });

    function updateTableContent(tabId) {
      // Find the content element in the active tab
      var tableBody = document.getElementById(`${tabId}-table-body`);
      tableBody.innerHTML = ""; // Clear existing content
      console.log(tableBody, tabId, alerts);
      // Update the content
      if (tabId == "alert") {
        if (alerts) {
          alerts.forEach((alert) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                    <td>${alert.type}</td>
                    <td>${alert.message}</td>
                    <td>${alert.time}</td>
                    <td>extend</td>
                    <td><button class="btn btn-blue">Save</button></td>
                `;

            tableBody.appendChild(row);
          });
        } else {
          // placeholder for artifact table body
          for (let i = 0; i < 5; i++) {
            const row = document.createElement("tr");
            row.classList.add("placeholder-glow");
            row.innerHTML = `
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                `;

            tableBody.appendChild(row);
          }
        }
      } else if (tabId == "certificate") {
        if (certs) {
          certs.forEach((cert) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                    <td>${cert.name}</td>
                    <td>${cert.cname}</td>
                    <td>${cert.valid}</td>
                    <td><button class="btn btn-blue">Save</button></td>
                `;

            tableBody.appendChild(row);
          });
        } else {
          // placeholder for artifact table body
          for (let i = 0; i < 5; i++) {
            const row = document.createElement("tr");
            row.classList.add("placeholder-glow");
            row.innerHTML = `
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                `;

            tableBody.appendChild(row);
          }
        }
      } else if (tabId == "device") {
        if (devices) {
          devices.forEach((device) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                    <td>${device.name}</td>
                    <td>${device.serial}</td>
                    <td>${device.domain}</td>
                    <td>${device.status}</td>
                    <td><button class="btn btn-blue">Save</button></td>
                `;

            tableBody.appendChild(row);
          });
        } else {
          // placeholder for artifact table body
          for (let i = 0; i < 5; i++) {
            const row = document.createElement("tr");
            row.classList.add("placeholder-glow");
            row.innerHTML = `
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                `;

            tableBody.appendChild(row);
          }
        }
      }
    }

    function updateChartContent(chartTabId) {
      console.log("chartTabId", chartTabId);
      if (chartTabId == "deviceChartTab") {
        var ctx = document.getElementById("stackChartDevice").getContext("2d");
        var stackChartConfig = JSON.parse("{{ stack_chart_config|escapejs }}");
        var stackChartDevice = new Chart(ctx, stackChartConfig);

        var ctx = document.getElementById("donutChartDevice").getContext("2d");
        var donutChartDeviceConfig = JSON.parse("{{ donut_chart_config|escapejs }}");
        var donutChartDevice = new Chart(ctx, donutChartDeviceConfig);
      } else if (chartTabId == "certChartTab") {
        var ctx = document.getElementById("donutChartCert").getContext("2d");
        var donutChartCertConfig = JSON.parse("{{ endpoint_donut_chart_config|escapejs }}");
        var donutChartCert = new Chart(ctx, donutChartCertConfig);

        var ctx = document.getElementById("stackedAreaChartCert").getContext("2d");
        var stackedAreaCertChartConfig = JSON.parse("{{ stack_area_chart_config|escapejs }}");
        var stackedAreaCertChart = new Chart(ctx, stackedAreaCertChartConfig);
      } else if (chartTabId == "caChartTab") {
        var ctx = document.getElementById(" barChartCA").getContext("2d");
        var barChartCAConfig = JSON.parse("{{ bar_chart_config|escapejs }}");
        var barChartCA = new Chart(ctx, barChartCAConfig);
        var ctx = document.getElementById("lineChart").getContext("2d");
        var lineChartConfig = JSON.parse("{{ line_chart_config|escapejs }}");
        var lineChart = new Chart(ctx, lineChartConfig);
      }
    }
  });
</script>

{% endblock content %}
