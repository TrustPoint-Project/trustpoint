{% extends 'trustpoint/base.html' %} {% block content %}

{% include 'home/counts-panel.html' %} 
{% include 'home/tables-tab.html' %} 
{% include 'home/charts-tab.html' %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var alerts = JSON.parse("{{alerts|escapejs }}");
    var certs = JSON.parse("{{certs|escapejs }}");
    var devices = JSON.parse("{{devices|escapejs }}");


    var tableTabEl = document.getElementById("tableTabs");
    //console.log("tableTabEl", tabEl);
    var tableTab = new bootstrap.Tab(tableTabEl);
    // Initial update for the active tab
    var activeTabId = document
      .querySelector("#tableTabs .nav-link.active")
      .getAttribute("href")
      .substring(1);
    updateTableContent(activeTabId);

    // Add event listener for the 'shown.bs.tab' event
    tableTabEl.addEventListener("shown.bs.tab", function (event) {
      var targetId = event.target.getAttribute("href").substring(1);
      updateTableContent(targetId);
    });

    var chartTabEl = document.getElementById("chartTabs");
    console.log("chartTabEl", chartTabEl);
    var chartTab = new bootstrap.Tab(chartTabEl);
    // Initial update for the active tab
    var activeChartTabId = document
      .querySelector("#chartTabs .nav-link.active")
      .getAttribute("href")
      .substring(1);
    updateChartContent(activeChartTabId);

    // Add event listener for the 'shown.bs.tab' event
    chartTabEl.addEventListener("shown.bs.tab", function (event) {
      var targetId = event.target.getAttribute("href").substring(1);
      updateChartContent(targetId);
    });

    function updateTableContent(tabId) {
      // Find the content element in the active tab
      var tableBody = document.getElementById(`${tabId}-table-body`);
      tableBody.innerHTML = ""; // Clear existing content
      console.log(tableBody, tabId, alerts);
      // Update the content
      if (tabId == "alert" || tabId == "notification") {
        if (alerts) {
          alerts.forEach((alert) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                    <td>${alert.type}</td>
                    <td>${alert.message}</td>
                    <td>${alert.time}</td>
                    <td>extend</td>
                    <td><button class="btn btn-blue">Details</button></td>
                `;

            tableBody.appendChild(row);
          });
        } else {
          // placeholder for artifact table body
          for (let i = 0; i < 5; i++) {
            const row = document.createElement("tr");
            row.classList.add("placeholder-glow");
            row.innerHTML = `
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                `;

            tableBody.appendChild(row);
          }
        }
      } else if (tabId == "certificate") {
        if (certs) {
          certs.forEach((cert) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                    <td>${cert.cname}</td>
                    <td>${cert.ica}</td>
                    <td>${cert.message}</td>
                    <td>${cert.time}</td>
                    <td><button class="btn btn-blue">Details</button></td>
                `;

            tableBody.appendChild(row);
          });
        } else {
          // placeholder for artifact table body
          for (let i = 0; i < 5; i++) {
            const row = document.createElement("tr");
            row.classList.add("placeholder-glow");
            row.innerHTML = `
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                `;

            tableBody.appendChild(row);
          }
        }
      } else if (tabId == "device") {
        if (devices) {
          devices.forEach((device) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                    <td>${device.device}</td>
                    <td>${device.domain}</td>
                    <td>${device.message}</td>
                    <td>${device.time}</td>
                    <td><button class="btn btn-blue">Details</button></td>
                `;

            tableBody.appendChild(row);
          });
        } else {
          // placeholder for artifact table body
          for (let i = 0; i < 5; i++) {
            const row = document.createElement("tr");
            row.classList.add("placeholder-glow");
            row.innerHTML = `
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                    <td><span class="placeholder col-2"></span></td>
                `;

            tableBody.appendChild(row);
          }
        }
      }
    }

    function updateChartContent(chartTabId) {
      console.log("chartTabId", chartTabId);
      if (chartTabId == "deviceChartTab") {
        var ctx = document.getElementById("lineChartDevice").getContext("2d");
        var stackChartConfig = JSON.parse("{{ line_chart_device_config|escapejs }}");
        var lineChartDevice = new Chart(ctx, stackChartConfig);

        var ctx = document.getElementById("donutChartDevice").getContext("2d");
        var donutChartDeviceConfig = JSON.parse("{{ donut_chart_device_config|escapejs }}");
        var donutChartDevice = new Chart(ctx, donutChartDeviceConfig);

        var ctx = document.getElementById("barChartDevice").getContext("2d");
        var barChartDeviceConfig = JSON.parse("{{ bar_chart_device_config|escapejs }}");
        var barChartDevice = new Chart(ctx, barChartDeviceConfig);
      } else if (chartTabId == "certChartTab") {
        var ctx = document.getElementById("lineChartCert").getContext("2d");
        var lineChartCertConfig = JSON.parse("{{ line_chart_cert_config|escapejs }}");
        var lineChartCert = new Chart(ctx, lineChartCertConfig);

        var ctx = document.getElementById("donutChartCert").getContext("2d");
        var donutChartCertConfig = JSON.parse("{{ donut_chart_cert_config|escapejs }}");
        var donutChartCert = new Chart(ctx, donutChartCertConfig);

        var ctx = document.getElementById("barChartCert").getContext("2d");
        var barChartCertConfig = JSON.parse("{{ bar_chart_cert_config|escapejs }}");
        var barChartCert = new Chart(ctx, barChartCertConfig);
      } else if (chartTabId == "caChartTab") {
        var ctx = document.getElementById(" barChartCA").getContext("2d");
        var barChartCAConfig = JSON.parse("{{ bar_chart_config|escapejs }}");
        var barChartCA = new Chart(ctx, barChartCAConfig);

        var ctx = document.getElementById("lineChart").getContext("2d");
        var lineChartConfig = JSON.parse("{{ line_chart_config|escapejs }}");
        var lineChart = new Chart(ctx, lineChartConfig);
      }
    }
  });
</script>

{% endblock content %}
