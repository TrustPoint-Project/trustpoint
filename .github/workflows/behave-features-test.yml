name: Behave Feature Tests

on:
  push:
    paths:
      - trustpoint/features/**
  pull_request:
    branches:
      - "main"

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install the latest version of uv
      uses: astral-sh/setup-uv@v5
      with:
        python-version: 3.12

    - name: Run Behave Tests and Generate HTML Report
      run: |
        uv run behave trustpoint/manage.py features/ --no-capture \
        -f behave_html_pretty_formatter:PrettyHTMLFormatter \
        -D behave.formatter.html-pretty.title_string="TrustPoint Test Report" \
        -o behave-report.html || true

    - name: Upload HTML Report
      uses: actions/upload-artifact@v4
      with:
        name: behave-html-report
        path: behave-report.html